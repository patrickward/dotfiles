#!/usr/bin/env bash
# Clean up merged branches with confirmation
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "Not a git repository"
    exit 1
fi

base=${1:-main}

branches=$(git branch --merged origin/$base | \
    grep -v "^\*" | \
    grep -v "main" | \
    grep -v "master" | \
    grep -v "develop" | \
    sed 's/^[[:space:]]*//')

if [ -z "$branches" ]; then
    echo "No merged branches to clean up"
    exit 0
fi

echo "Branches merged into origin/$base:"
echo "${branches//^/  }"

printf "\nDelete these branches? (y/N): "
read -r response
if [[ ! "$response" =~ ^[Yy]$ ]]; then
    echo "Cancelled"
    exit 0
fi

echo "$branches" | while read branch; do
    git branch -d "$branch" && echo "  âœ“ Deleted: $branch"
done

